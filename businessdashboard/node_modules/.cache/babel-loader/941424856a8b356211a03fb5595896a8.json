{"ast":null,"code":"/**********************************************************************\n node-feedparser - A robust RSS, Atom, RDF parser for node.\n http://github.com/danmactough/node-feedparser\n Copyright (c) 2011-2016 Dan MacTough and contributors\n http://mact.me\n\n**********************************************************************/\n\n/**\n * Module dependencies.\n */\nvar sax = require('sax'),\n    addressparser = require('addressparser'),\n    indexOfObject = require('array-indexofobject'),\n    util = require('util'),\n    TransformStream = require('readable-stream').Transform,\n    _ = require('../utils');\n/**\n * FeedParser constructor.\n *\n * Exposes a duplex (transform) stream to parse a feed.\n *\n * Each article/post in the feed will have the following keys:\n *   - title {String}\n *   - description {String}\n *   - summary {String}\n *   - date {Date} (or null)\n *   - pubdate {Date} (or null)\n *   - link {String}\n *   - origlink {String}\n *   - author {String}\n *   - guid {String}\n *   - comments {String}\n *   - image {Object}\n *   - categories {Array}\n *   - source {Object}\n *   - enclosures {Array}\n *   - meta {Object}\n *   - Object.keys(meta):\n *     - #ns {Array} key,value pairs of each namespace declared for the feed\n *     - #type {String} one of 'atom', 'rss', 'rdf'\n *     - #version {String}\n *     - title {String}\n *     - description {String}\n *     - date {Date} (or null)\n *     - pubdate {Date} (or null)\n *     - link {String} i.e., to the website, not the feed\n *     - xmlurl {String} the canonical URL of the feed, as declared by the feed\n *     - author {String}\n *     - language {String}\n *     - image {Object}\n *     - favicon {String}\n *     - copyright {String}\n *     - generator {String}\n *     - categories {Array}\n *\n * @param {Object} options\n * @api public\n */\n\n\nfunction FeedParser(options) {\n  if (!(this instanceof FeedParser)) return new FeedParser(options);\n  TransformStream.call(this);\n  this._readableState.objectMode = true;\n  this._readableState.highWaterMark = 16; // max. # of output nodes buffered\n\n  this.init(); // Parse options\n\n  this.options = _.assign({}, options);\n  if (!('strict' in this.options)) this.options.strict = false;\n  if (!('normalize' in this.options)) this.options.normalize = true;\n  if (!('addmeta' in this.options)) this.options.addmeta = true;\n  if (!('resume_saxerror' in this.options)) this.options.resume_saxerror = true;\n\n  if ('MAX_BUFFER_LENGTH' in this.options) {\n    sax.MAX_BUFFER_LENGTH = this.options.MAX_BUFFER_LENGTH; // set to Infinity to have unlimited buffers\n  } else {\n    sax.MAX_BUFFER_LENGTH = 16 * 1024 * 1024; // 16M versus the 64K default\n  }\n\n  if (this.options.feedurl) this.xmlbase.unshift({\n    '#name': 'xml',\n    '#': this.options.feedurl\n  }); // See https://github.com/isaacs/sax-js for more info\n\n  this.stream = sax.createStream(this.options.strict\n  /* strict mode - no by default */\n  , {\n    lowercase: true,\n    xmlns: true\n  });\n  this.stream.on('error', this.handleSaxError.bind(this));\n  this.stream.on('processinginstruction', this.handleProcessingInstruction.bind(this));\n  this.stream.on('opentag', this.handleOpenTag.bind(this));\n  this.stream.on('closetag', this.handleCloseTag.bind(this));\n  this.stream.on('text', this.handleText.bind(this));\n  this.stream.on('cdata', this.handleText.bind(this));\n  this.stream.on('end', this.handleEnd.bind(this));\n}\n\nutil.inherits(FeedParser, TransformStream);\n/*\n * Initializes the SAX stream\n *\n * Initializes the class-variables\n */\n\nFeedParser.prototype.init = function () {\n  this.meta = {\n    '#ns': [],\n    '@': [],\n    '#xml': {}\n  };\n  this._namespaces = {};\n  this._emitted_meta = false;\n  this.stack = [];\n  this.xmlbase = [];\n  this.in_xhtml = false;\n  this.xhtml = {};\n  /* Where to store xhtml elements as associative\n     array with keys: '#' (containing the text)\n     and '#name' (containing the XML element name) */\n\n  this.errors = [];\n};\n\nFeedParser.prototype.handleEnd = function () {\n  // We made it to the end without throwing, but let's make sure we were actually\n  // parsing a feed\n  if (!(this.meta && this.meta['#type'])) {\n    var e = new Error('Not a feed');\n    return this.handleError(e);\n  }\n\n  this.push(null);\n};\n\nFeedParser.prototype.handleSaxError = function (e) {\n  this.emit('error', e);\n\n  if (this.options.resume_saxerror) {\n    this.resumeSaxError();\n  }\n};\n\nFeedParser.prototype.resumeSaxError = function () {\n  if (this.stream._parser) {\n    this.stream._parser.error = null;\n\n    this.stream._parser.resume();\n  }\n};\n\nFeedParser.prototype.handleError = function (e) {\n  this.emit('error', e);\n}; // parses the xml declaration, which looks like:\n// <?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n\n\nFeedParser.prototype.handleProcessingInstruction = function (node) {\n  if (node.name === 'xml') {\n    this.meta['#xml'] = node.body.trim().split(/\\s+/).reduce(function (map, attr) {\n      if (attr.indexOf('=') >= 0) {\n        var parts = attr.split('=');\n        map[parts[0]] = parts[1] && parts[1].length > 2 && parts[1].match(/^.(.*?).$/)[1];\n      }\n\n      return map;\n    }, this.meta['#xml']);\n  }\n};\n\nFeedParser.prototype.handleOpenTag = function (node) {\n  var n = {};\n  n['#name'] = node.name; // Avoid namespace collissions later...\n\n  n['#prefix'] = node.prefix; // The current ns prefix\n\n  n['#local'] = node.local; // The current element name, sans prefix\n\n  n['#uri'] = node.uri; // The current ns uri\n\n  n['@'] = {};\n  n['#'] = '';\n\n  if (Object.keys(node.attributes).length) {\n    n['@'] = this.handleAttributes(node.attributes, n['#name']);\n  }\n\n  if (this.in_xhtml && this.xhtml['#name'] != n['#name']) {\n    // We are in an xhtml node\n    // This builds the opening tag, e.g., <div id='foo' class='bar'>\n    this.xhtml['#'] += '<' + n['#name'];\n    Object.keys(n['@']).forEach(function (name) {\n      this.xhtml['#'] += ' ' + name + '=\"' + n['@'][name] + '\"';\n    }, this);\n    this.xhtml['#'] += '>';\n  } else if (this.stack.length === 0 && (n['#name'] === 'rss' || n['#local'] === 'rdf' && _.nslookup([n['#uri']], 'rdf') || n['#local'] === 'feed' && _.nslookup([n['#uri']], 'atom'))) {\n    Object.keys(n['@']).forEach(function (name) {\n      var o = {};\n\n      if (name != 'version') {\n        o[name] = n['@'][name];\n        this.meta['@'].push(o);\n      }\n    }, this);\n\n    switch (n['#local']) {\n      case 'rss':\n        this.meta['#type'] = 'rss';\n        this.meta['#version'] = n['@']['version'];\n        break;\n\n      case 'rdf':\n        this.meta['#type'] = 'rdf';\n        this.meta['#version'] = n['@']['version'] || '1.0';\n        break;\n\n      case 'feed':\n        this.meta['#type'] = 'atom';\n        this.meta['#version'] = n['@']['version'] || '1.0';\n        break;\n    }\n  }\n\n  this.stack.unshift(n);\n};\n\nFeedParser.prototype.handleCloseTag = function (el) {\n  var node = {\n    '#name': el,\n    '#prefix': '',\n    '#local': ''\n  },\n      stdEl,\n      item,\n      baseurl,\n      isIllegallyNested = false;\n  var n = this.stack.shift();\n  el = el.split(':');\n\n  if (el.length > 1 && el[0] === n['#prefix']) {\n    if (_.nslookup(n['#uri'], 'atom')) {\n      node['#prefix'] = el[0];\n      node['#local'] = el.slice(1).join(':');\n      node['#type'] = 'atom';\n    } else if (_.nslookup(n['#uri'], 'rdf')) {\n      node['#prefix'] = el[0];\n      node['#local'] = el.slice(1).join(':');\n      node['#type'] = 'rdf';\n    } else {\n      node['#prefix'] = _.nsprefix(n['#uri']) || n['#prefix'];\n      node['#local'] = el.slice(1).join(':');\n    }\n  } else {\n    node['#local'] = node['#name'];\n    node['#type'] = _.nsprefix(n['#uri']) || n['#prefix'];\n  }\n\n  delete n['#name'];\n  delete n['#local'];\n  delete n['#prefix'];\n  delete n['#uri'];\n\n  if (this.xmlbase && this.xmlbase.length) {\n    baseurl = this.xmlbase[0]['#'];\n  }\n\n  var mayHaveResolvableUrl = (node['#local'] === 'logo' || node['#local'] === 'icon') && node['#type'] === 'atom' || node['#local'] === 'link' // include rss:link, even though it should _never_ be a relative URL\n  ;\n\n  if (baseurl && mayHaveResolvableUrl) {\n    // Apply xml:base to these elements as they appear\n    // rather than leaving it to the ultimate parser\n    n['#'] = _.resolve(baseurl, n['#']);\n  }\n\n  if (this.xmlbase.length && el == this.xmlbase[0]['#name']) {\n    void this.xmlbase.shift();\n  }\n\n  if (this.in_xhtml) {\n    if (node['#name'] == this.xhtml['#name']) {\n      // The end of the XHTML\n      // Add xhtml data to the container element\n      n['#'] += this.xhtml['#'].trim(); // Clear xhtml nodes from the tree\n\n      for (var key in n) {\n        if (key != '@' && key != '#') {\n          delete n[key];\n        }\n      }\n\n      this.xhtml = {};\n      this.in_xhtml = false;\n    } else {\n      // Somewhere in the middle of the XHTML\n      this.xhtml['#'] += '</' + node['#name'] + '>';\n    }\n  }\n\n  if ('#' in n) {\n    if (n['#'].match(/^\\s*$/)) {\n      // Delete text nodes with nothing by whitespace\n      delete n['#'];\n    } else {\n      n['#'] = n['#'].trim();\n\n      if (Object.keys(n).length === 1) {\n        // If there is only one text node, hoist it\n        n = n['#'];\n      }\n    }\n  }\n\n  if (node['#name'] === 'item' || node['#name'] === 'entry' || node['#local'] === 'item' && (node['#prefix'] === '' || node['#type'] === 'rdf') || node['#local'] == 'entry' && (node['#prefix'] === '' || node['#type'] === 'atom')) {\n    // We have an article!\n    isIllegallyNested = node['#name'] === 'item' && this.stack[0]['#name'] === 'item' || node['#name'] === 'entry' && this.stack[0]['#name'] === 'entry' || node['#local'] === 'item' && (node['#prefix'] === '' || node['#type'] === 'rdf') && this.stack[0]['#name'] === 'item' || node['#local'] == 'entry' && (node['#prefix'] === '' || node['#type'] === 'atom') && this.stack[0]['#name'] === 'entry';\n\n    if (isIllegallyNested) {\n      return;\n    }\n\n    if (!this.meta.title) {\n      // We haven't yet parsed all the metadata\n      _.assign(this.meta, this.handleMeta(this.stack[0], this.meta['#type'], this.options));\n\n      if (!this._emitted_meta) {\n        this.emit('meta', this.meta);\n        this._emitted_meta = true;\n      }\n    }\n\n    if (!baseurl && this.xmlbase && this.xmlbase.length) {\n      // handleMeta was able to infer a baseurl without xml:base or options.feedurl\n      n = _.reresolve(n, this.xmlbase[0]['#']);\n    }\n\n    item = this.handleItem(n, this.meta['#type'], this.options);\n\n    if (this.options.addmeta) {\n      item.meta = this.meta;\n    }\n\n    if (this.meta.author && !item.author) item.author = this.meta.author;\n    this.push(item);\n  } else if (!this.meta.title && ( // We haven't yet parsed all the metadata\n  node['#name'] === 'channel' || node['#name'] === 'feed' || node['#local'] === 'channel' && (node['#prefix'] === '' || node['#type'] === 'rdf') || node['#local'] === 'feed' && (node['#prefix'] === '' || node['#type'] === 'atom'))) {\n    _.assign(this.meta, this.handleMeta(n, this.meta['#type'], this.options));\n\n    if (!this._emitted_meta) {\n      this.emit('meta', this.meta);\n      this._emitted_meta = true;\n    }\n  }\n\n  if (this.stack.length > 0) {\n    if (node['#prefix'] && node['#local'] && !node['#type']) {\n      stdEl = node['#prefix'] + ':' + node['#local'];\n    } else if (node['#name'] && node['#type'] && node['#type'] !== this.meta['#type']) {\n      stdEl = node['#name'];\n    } else {\n      stdEl = node['#local'] || node['#name'];\n    }\n\n    if (!this.stack[0].hasOwnProperty(stdEl)) {\n      this.stack[0][stdEl] = n;\n    } else if (this.stack[0][stdEl] instanceof Array) {\n      this.stack[0][stdEl].push(n);\n    } else {\n      this.stack[0][stdEl] = [this.stack[0][stdEl], n];\n    }\n  }\n};\n\nFeedParser.prototype.handleText = function (text) {\n  if (this.in_xhtml) {\n    this.xhtml['#'] += text;\n  } else {\n    if (this.stack.length) {\n      if (this.stack[0] && '#' in this.stack[0]) {\n        this.stack[0]['#'] += text;\n      } else {\n        this.stack[0]['#'] = text;\n      }\n    }\n  }\n};\n\nFeedParser.prototype.handleAttributes = function handleAttributes(attrs, el) {\n  /*\n   * Using the sax.js option { xmlns: true }\n   * attrs is an array of objects (not strings) having the following properties\n   * name - e.g., xmlns:dc or href\n   * value\n   * prefix - the first part of the name of the attribute (before the colon)\n   * local - the second part of the name of the attribute (after the colon)\n   * uri - the uri of the namespace\n   *\n   */\n  var basepath = '',\n      simplifiedAttributes = {};\n\n  if (this.xmlbase && this.xmlbase.length) {\n    basepath = this.xmlbase[0]['#'];\n  }\n\n  Object.keys(attrs).forEach(function (key) {\n    var attr = attrs[key],\n        ns = {},\n        prefix = '';\n\n    if (attr.prefix === 'xmlns') {\n      if (!(attr.name in this._namespaces)) {\n        ns[attr.name] = attr.value;\n        this.meta['#ns'].push(ns);\n\n        _.assign(this._namespaces, ns);\n      }\n    } // If the feed is using a non-default prefix, we'll use it, too\n    // But we force the use of the 'xml' prefix\n\n\n    if (attr.uri && attr.prefix && !_.nslookup(attr.uri, attr.prefix) || _.nslookup(attr.uri, 'xml')) {\n      prefix = (_.nsprefix(attr.uri) || attr.prefix) + (attr.local ? ':' : '');\n    }\n\n    if (basepath && (attr.local == 'href' || attr.local == 'src' || attr.local == 'uri')) {\n      // Apply xml:base to these elements as they appear\n      // rather than leaving it to the ultimate parser\n      attr.value = _.resolve(basepath, attr.value);\n    } else if (attr.local === 'base' && _.nslookup(attr.uri, 'xml')) {\n      // Keep track of the xml:base for the current node\n      if (basepath) {\n        attr.value = _.resolve(basepath, attr.value);\n      }\n\n      this.xmlbase.unshift({\n        '#name': el,\n        '#': attr.value\n      });\n    } else if (attr.name === 'type' && attr.value === 'xhtml') {\n      this.in_xhtml = true;\n      this.xhtml = {\n        '#name': el,\n        '#': ''\n      };\n    }\n\n    simplifiedAttributes[prefix + attr.local] = attr.value ? attr.value.trim() : '';\n  }, this);\n  return simplifiedAttributes;\n};\n\nFeedParser.prototype.handleMeta = function handleMeta(node, type, options) {\n  if (!type || !node) return {};\n  var meta = {},\n      normalize = !options || options && options.normalize;\n\n  if (normalize) {\n    ['title', 'description', 'date', 'pubdate', 'pubDate', 'link', 'xmlurl', 'xmlUrl', 'author', 'language', 'favicon', 'copyright', 'generator'].forEach(function (property) {\n      meta[property] = null;\n    });\n    meta.cloud = {};\n    meta.image = {};\n    meta.categories = [];\n  }\n\n  Object.keys(node).forEach(function (name) {\n    var el = node[name];\n\n    if (normalize) {\n      switch (name) {\n        case 'title':\n          meta.title = _.get(el);\n          break;\n\n        case 'description':\n        case 'subtitle':\n          meta.description = _.get(el);\n          break;\n\n        case 'pubdate':\n        case 'lastbuilddate':\n        case 'published':\n        case 'modified':\n        case 'updated':\n        case 'dc:date':\n          var date = _.get(el) ? new Date(_.get(el)) : null;\n          if (!date) break;\n          if (meta.pubdate === null || name == 'pubdate' || name == 'published') meta.pubdate = meta.pubDate = date;\n          if (meta.date === null || name == 'lastbuilddate' || name == 'modified' || name == 'updated') meta.date = date;\n          break;\n\n        case 'link':\n        case 'atom:link':\n        case 'atom10:link':\n          if (Array.isArray(el)) {\n            el.forEach(function (link) {\n              if (link['@']['href']) {\n                // Atom\n                if (_.get(link['@'], 'rel')) {\n                  if (link['@']['rel'] == 'alternate') {\n                    if (!meta.link) meta.link = link['@']['href'];\n                  } else if (link['@']['rel'] == 'self') {\n                    meta.xmlurl = meta.xmlUrl = link['@']['href'];\n\n                    if (_.isAbsoluteUrl(meta.xmlurl) && this.xmlbase && this.xmlbase.length === 0) {\n                      this.xmlbase.unshift({\n                        '#name': 'xml',\n                        '#': meta.xmlurl\n                      });\n                      this.stack[0] = _.reresolve(this.stack[0], meta.xmlurl);\n                    } else if (this.xmlbase && this.xmlbase.length > 0) {\n                      meta.xmlurl = meta.xmlUrl = _.resolve(_.get(this.xmlbase[0], '#'), meta.xmlurl);\n                    }\n                  } else if (link['@']['rel'] == 'hub' && !(meta.cloud.href || meta.cloud.domain)) {\n                    meta.cloud.type = 'hub';\n                    meta.cloud.href = link['@']['href'];\n                  }\n                } else {\n                  if (!meta.link) meta.link = link['@']['href'];\n                }\n              } else if (Object.keys(link['@']).length === 0) {\n                // RSS\n                meta.link = _.get(link);\n              }\n\n              if (_.isAbsoluteUrl(meta.link) && this.xmlbase && this.xmlbase.length === 0) {\n                this.xmlbase.unshift({\n                  '#name': 'xml',\n                  '#': meta.link\n                });\n                this.stack[0] = _.reresolve(this.stack[0], meta.link);\n              } else if (this.xmlbase && this.xmlbase.length > 0) {\n                meta.link = _.resolve(_.get(this.xmlbase[0], '#'), meta.link);\n              }\n            }, this);\n          } else {\n            if (el['@']['href']) {\n              // Atom\n              if (_.get(el['@'], 'rel')) {\n                if (el['@']['rel'] == 'alternate') {\n                  if (!meta.link) meta.link = el['@']['href'];\n                } else if (el['@']['rel'] == 'self') {\n                  meta.xmlurl = meta.xmlUrl = el['@']['href'];\n\n                  if (_.isAbsoluteUrl(meta.xmlurl) && this.xmlbase && this.xmlbase.length === 0) {\n                    this.xmlbase.unshift({\n                      '#name': 'xml',\n                      '#': meta.xmlurl\n                    });\n                    this.stack[0] = _.reresolve(this.stack[0], meta.xmlurl);\n                  } else if (this.xmlbase && this.xmlbase.length > 0) {\n                    meta.xmlurl = meta.xmlUrl = _.resolve(_.get(this.xmlbase[0], '#'), meta.xmlurl);\n                  }\n                } else if (el['@']['rel'] == 'hub' && !(meta.cloud.href || meta.cloud.domain)) {\n                  meta.cloud.type = 'hub';\n                  meta.cloud.href = el['@']['href'];\n                }\n              } else {\n                meta.link = el['@']['href'];\n              }\n            } else if (Object.keys(el['@']).length === 0) {\n              // RSS\n              if (!meta.link) meta.link = _.get(el);\n            }\n\n            if (_.isAbsoluteUrl(meta.link) && this.xmlbase && this.xmlbase.length === 0) {\n              this.xmlbase.unshift({\n                '#name': 'xml',\n                '#': meta.link\n              });\n              this.stack[0] = _.reresolve(this.stack[0], meta.link);\n            } else if (this.xmlbase && this.xmlbase.length > 0) {\n              meta.link = _.resolve(_.get(this.xmlbase[0], '#'), meta.link);\n            }\n          }\n\n          break;\n\n        case 'managingeditor':\n        case 'webmaster':\n        case 'author':\n          var author = {};\n\n          if (name == 'author') {\n            meta.author = _.get(el.name) || _.get(el.email) || _.get(el.uri);\n          } else if (_.get(el)) {\n            author = addressparser(_.get(el))[0];\n\n            if (author) {\n              el['name'] = author.name;\n              el['email'] = author.address;\n            }\n\n            if (meta.author === null || name == 'managingeditor') {\n              meta.author = author.name || author.address || _.get(el);\n            }\n          }\n\n          break;\n\n        case 'cloud':\n          // I can't believe someone actually would put two cloud elements in their channel\n          // but it happened\n          // Nevertheless, there can be only one\n          // This will ensure that rssCloud \"wins\" here.\n          // If pubsubhubbub is also declared, it's still available in the link elements\n          meta.cloud = {};\n\n          if (Array.isArray(el)) {\n            Object.keys(el[0]['@']).forEach(function (attr) {\n              if (_.has(el[0]['@'], attr)) {\n                meta.cloud[attr] = el[0]['@'][attr];\n              }\n            });\n          } else {\n            Object.keys(el['@']).forEach(function (attr) {\n              if (_.has(el['@'], attr)) {\n                meta.cloud[attr] = el['@'][attr];\n              }\n            });\n          }\n\n          meta.cloud.type = 'rsscloud';\n          break;\n\n        case 'language':\n          meta.language = _.get(el);\n          break;\n\n        case 'image':\n        case 'logo':\n          if (el.url) meta.image.url = _.get(el.url);\n          if (el.title) meta.image.title = _.get(el.title);\n          if (!meta.image.url && _.get(el)) meta.image.url = _.get(el);\n          break;\n\n        case 'icon':\n          meta.favicon = _.get(el);\n          break;\n\n        case 'copyright':\n        case 'rights':\n        case 'dc:rights':\n          meta.copyright = _.get(el);\n          break;\n\n        case 'generator':\n          meta.generator = _.get(el);\n          if (_.get(el['@'], 'version')) meta.generator += (meta.generator ? ' ' : '') + 'v' + el['@'].version;\n          if (_.get(el['@'], 'uri')) meta.generator += meta.generator ? ' (' + el['@'].uri + ')' : el['@'].uri;\n          break;\n\n        case 'category':\n        case 'dc:subject':\n        case 'itunes:category':\n        case 'media:category':\n          /* We handle all the kinds of categories within the switch loop because meta.categories\n           * is an array, unlike the other properties, and therefore can handle multiple values\n           */\n          var _category = '',\n              _categories = [];\n\n          if (Array.isArray(el)) {\n            el.forEach(function (category) {\n              var _categoryValue;\n\n              if ('category' == name && 'atom' == type) {\n                if (category['@'] && (_categoryValue = _.safeTrim(_.get(category['@'], 'term')))) {\n                  meta.categories.push(_categoryValue);\n                }\n              } else if ('category' == name && 'rss' == type) {\n                if (_categoryValue = _.safeTrim(_.get(category))) {\n                  meta.categories.push(_categoryValue);\n                }\n              } else if ('dc:subject' == name && (_categoryValue = _.safeTrim(_.get(category)))) {\n                _categories = _categoryValue.split(' ').map(function (cat) {\n                  return cat.trim();\n                });\n\n                if (_categories.length) {\n                  meta.categories = meta.categories.concat(_categories);\n                }\n              } else if ('itunes:category' == name) {\n                if (category['@'] && _.safeTrim(_.get(category['@'], 'text'))) _category = _.safeTrim(_.get(category['@'], 'text'));\n\n                if (category[name]) {\n                  if (Array.isArray(category[name])) {\n                    category[name].forEach(function (subcategory) {\n                      var _subcategoryValue;\n\n                      if (subcategory['@'] && (_subcategoryValue = _.safeTrim(_.get(subcategory['@'], 'text')))) {\n                        meta.categories.push(_category + '/' + _subcategoryValue);\n                      }\n                    });\n                  } else if (category[name]['@'] && (_categoryValue = _.safeTrim(_.get(category[name]['@'], 'text')))) {\n                    meta.categories.push(_category + '/' + _categoryValue);\n                  }\n                } else if (_category) {\n                  meta.categories.push(_category);\n                }\n              } else if ('media:category' == name && (_categoryValue = _.safeTrim(_.get(category)))) {\n                meta.categories.push(_categoryValue);\n              }\n            });\n          } else {\n            if ('category' == name && 'atom' == type) {\n              if (_category = _.safeTrim(_.get(el['@'], 'term'))) {\n                meta.categories.push(_category);\n              }\n            } else if ('category' == name && 'rss' == type) {\n              if (_category = _.safeTrim(_.get(el))) {\n                meta.categories.push(_category);\n              }\n            } else if ('dc:subject' == name && (_category = _.safeTrim(_.get(el)))) {\n              _categories = _category.split(' ').map(function (cat) {\n                return cat.trim();\n              });\n\n              if (_categories.length) {\n                meta.categories = meta.categories.concat(_categories);\n              }\n            } else if ('itunes:category' == name) {\n              if (el['@'] && _.safeTrim(_.get(el['@'], 'text'))) _category = _.safeTrim(_.get(el['@'], 'text'));\n\n              if (el[name]) {\n                if (Array.isArray(el[name])) {\n                  el[name].forEach(function (subcategory) {\n                    var _subcategoryValue;\n\n                    if (subcategory['@'] && (_subcategoryValue = _.safeTrim(_.get(subcategory['@'], 'text')))) {\n                      meta.categories.push(_category + '/' + _subcategoryValue);\n                    }\n                  });\n                } else if (el[name]['@'] && (_category = _.safeTrim(_.get(el[name]['@'], 'text')))) {\n                  meta.categories.push(_category + '/' + _category);\n                }\n              } else if (_category) {\n                meta.categories.push(_category);\n              }\n            } else if ('media:category' == name && (_category = _.safeTrim(_.get(el)))) {\n              meta.categories.push(_.get(el));\n            }\n          }\n\n          break;\n      } // switch end\n\n    } // Fill with all native other namespaced properties\n\n\n    if (name.indexOf('#') !== 0) {\n      if (~name.indexOf(':')) meta[name] = el;else meta[type + ':' + name] = el;\n    }\n  }, this); // forEach end\n\n  if (normalize) {\n    if (!meta.description) {\n      if (node['itunes:summary']) meta.description = _.get(node['itunes:summary']);else if (node['tagline']) meta.description = _.get(node['tagline']);\n    }\n\n    if (!meta.author) {\n      if (node['itunes:author']) meta.author = _.get(node['itunes:author']);else if (node['itunes:owner'] && node['itunes:owner']['itunes:name']) meta.author = _.get(node['itunes:owner']['itunes:name']);else if (node['dc:creator']) meta.author = _.get(node['dc:creator']);else if (node['dc:publisher']) meta.author = _.get(node['dc:publisher']);\n    }\n\n    if (!meta.language) {\n      if (node['@'] && node['@']['xml:lang']) meta.language = _.get(node['@'], 'xml:lang');else if (node['dc:language']) meta.language = _.get(node['dc:language']);\n    }\n\n    if (!meta.image.url) {\n      if (node['itunes:image']) meta.image.url = _.get(node['itunes:image']['@'], 'href');else if (node['media:thumbnail']) {\n        if (Array.isArray(node['media:thumbnail'])) {\n          node['media:thumbnail'] = node['media:thumbnail'][0];\n        }\n\n        meta.image.url = _.get(node['media:thumbnail']['@'], 'url');\n      }\n    }\n\n    if (!meta.copyright) {\n      if (node['media:copyright']) meta.copyright = _.get(node['media:copyright']);else if (node['dc:rights']) meta.copyright = _.get(node['dc:rights']);else if (node['creativecommons:license']) meta.copyright = _.get(node['creativecommons:license']);else if (node['cc:license']) {\n        if (Array.isArray(node['cc:license']) && node['cc:license'][0]['@'] && node['cc:license'][0]['@']['rdf:resource']) {\n          meta.copyright = _.get(node['cc:license'][0]['@'], 'rdf:resource');\n        } else if (node['cc:license']['@'] && node['cc:license']['@']['rdf:resource']) {\n          meta.copyright = _.get(node['cc:license']['@'], 'rdf:resource');\n        }\n      }\n    }\n\n    if (!meta.generator) {\n      if (node['admin:generatoragent']) {\n        if (Array.isArray(node['admin:generatoragent']) && node['admin:generatoragent'][0]['@'] && node['admin:generatoragent'][0]['@']['rdf:resource']) {\n          meta.generator = _.get(node['admin:generatoragent'][0]['@'], 'rdf:resource');\n        } else if (node['admin:generatoragent']['@'] && node['admin:generatoragent']['@']['rdf:resource']) {\n          meta.generator = _.get(node['admin:generatoragent']['@'], 'rdf:resource');\n        }\n      }\n    }\n\n    if (meta.categories.length) {\n      meta.categories = _.uniq(meta.categories);\n    }\n\n    if (!meta.link) {\n      if (meta['atom:id'] && _.get(meta['atom:id']) && /^https?:/.test(_.get(meta['atom:id']))) {\n        meta.link = _.get(meta['atom:id']);\n      }\n    }\n\n    if (!meta.xmlurl && this.options.feedurl) {\n      meta.xmlurl = meta.xmlUrl = this.options.feedurl;\n    }\n\n    meta.title = meta.title && _.stripHtml(meta.title);\n    meta.description = meta.description && _.stripHtml(meta.description);\n  }\n\n  return meta;\n};\n\nFeedParser.prototype.handleItem = function handleItem(node, type, options) {\n  if (!type || !node) return {};\n  var item = {},\n      normalize = !options || options && options.normalize;\n\n  if (normalize) {\n    ['title', 'description', 'summary', 'date', 'pubdate', 'pubDate', 'link', 'guid', 'author', 'comments', 'origlink'].forEach(function (property) {\n      item[property] = null;\n    });\n    item.image = {};\n    item.source = {};\n    item.categories = [];\n    item.enclosures = [];\n  }\n\n  Object.keys(node).forEach(function (name) {\n    var el = node[name],\n        attrs = _.get(el, '@'),\n        enclosure;\n\n    if (normalize) {\n      switch (name) {\n        case 'title':\n          item.title = _.get(el);\n          break;\n\n        case 'description':\n        case 'summary':\n          item.summary = _.get(el);\n          if (!item.description) item.description = _.get(el);\n          break;\n\n        case 'content':\n        case 'content:encoded':\n          item.description = _.get(el);\n          break;\n\n        case 'pubdate':\n        case 'published':\n        case 'issued':\n        case 'modified':\n        case 'updated':\n        case 'dc:date':\n          var date = _.get(el) ? new Date(_.get(el)) : null;\n          if (!date) break;\n          if (item.pubdate === null || name == 'pubdate' || name == 'published' || name == 'issued') item.pubdate = item.pubDate = date;\n          if (item.date === null || name == 'modified' || name == 'updated') item.date = date;\n          break;\n\n        case 'link':\n          if (Array.isArray(el)) {\n            el.forEach(function (link) {\n              if (link['@']['href']) {\n                // Atom\n                if (_.get(link['@'], 'rel')) {\n                  if (link['@']['rel'] == 'canonical') item.origlink = link['@']['href'];\n                  if (link['@']['rel'] == 'alternate') item.link = link['@']['href'];\n                  if (link['@']['rel'] == 'self' && !item.link) item.link = link['@']['href'];\n                  if (link['@']['rel'] == 'replies') item.comments = link['@']['href'];\n\n                  if (link['@']['rel'] == 'enclosure') {\n                    enclosure = {};\n                    enclosure.url = link['@']['href'];\n                    enclosure.type = _.get(link['@'], 'type');\n                    enclosure.length = _.get(link['@'], 'length');\n\n                    if (indexOfObject(item.enclosures, enclosure, ['url', 'type']) === -1) {\n                      item.enclosures.push(enclosure);\n                    }\n                  }\n                } else {\n                  item.link = link['@']['href'];\n                }\n              } else if (Object.keys(link['@']).length === 0) {\n                // RSS\n                if (!item.link) item.link = _.get(link);\n              }\n            });\n          } else {\n            if (el['@']['href']) {\n              // Atom\n              if (_.get(el['@'], 'rel')) {\n                if (el['@']['rel'] == 'canonical') item.origlink = el['@']['href'];\n                if (el['@']['rel'] == 'alternate') item.link = el['@']['href'];\n                if (el['@']['rel'] == 'self' && !item.link) item.link = el['@']['href'];\n                if (el['@']['rel'] == 'replies') item.comments = el['@']['href'];\n\n                if (el['@']['rel'] == 'enclosure') {\n                  enclosure = {};\n                  enclosure.url = el['@']['href'];\n                  enclosure.type = _.get(el['@'], 'type');\n                  enclosure.length = _.get(el['@'], 'length');\n\n                  if (indexOfObject(item.enclosures, enclosure, ['url', 'type']) === -1) {\n                    item.enclosures.push(enclosure);\n                  }\n                }\n              } else {\n                item.link = el['@']['href'];\n              }\n            } else if (Object.keys(el['@']).length === 0) {\n              // RSS\n              if (!item.link) item.link = _.get(el);\n            }\n          }\n\n          if (!item.guid) item.guid = item.link;\n          break;\n\n        case 'guid':\n        case 'id':\n          item.guid = _.get(el); // http://cyber.law.harvard.edu/rss/rss.html#ltguidgtSubelementOfLtitemgt\n          // If the guid element has an attribute named \"isPermaLink\" with a value\n          // of true, the reader may assume that it is a permalink to the item,\n          // that is, a url that can be opened in a Web browser, that points to\n          // the full item described by the <item> element.\n          // isPermaLink is optional, its default value is true. If its value is\n          // false, the guid may not be assumed to be a url, or a url to anything\n          // in particular.\n\n          if (item.guid && type == 'rss' && name == 'guid' && !(attrs.ispermalink && attrs.ispermalink.match(/false/i))) {\n            item.permalink = item.guid;\n          }\n\n          break;\n\n        case 'author':\n          var author = {};\n\n          if (_.get(el)) {\n            // RSS\n            author = addressparser(_.get(el))[0];\n\n            if (author) {\n              el['name'] = author.name;\n              el['email'] = author.address;\n              item.author = author.name || author.address;\n            } // addressparser failed\n            else {\n                item.author = _.get(el);\n              }\n          } else {\n            item.author = _.get(el.name) || _.get(el.email) || _.get(el.uri);\n          }\n\n          break;\n\n        case 'dc:creator':\n          item.author = _.get(el);\n          break;\n\n        case 'comments':\n          item.comments = _.get(el);\n          break;\n\n        case 'source':\n          if ('rss' == type) {\n            item.source['title'] = _.get(el);\n            item.source['url'] = _.get(el['@'], 'url');\n          } else if ('atom' == type) {\n            if (el.title && _.get(el.title)) item.source['title'] = _.get(el.title);\n            if (el.link && _.get(el.link['@'], 'href')) item.source['url'] = _.get(el.link['@'], 'href');\n          }\n\n          if (item.source['url'] && !this.meta.xmlurl) {\n            this.meta.xmlurl = this.meta.xmlUrl = item.source['url'];\n\n            if (_.isAbsoluteUrl(item.source['url']) && this.xmlbase && this.xmlbase.length === 0) {\n              this.xmlbase.unshift({\n                '#name': 'xml',\n                '#': item.source['url']\n              });\n              this.stack[0] = _.reresolve(this.stack[0], item.source['url']);\n            } else if (this.xmlbase && this.xmlbase.length > 0) {\n              this.meta.xmlurl = this.meta.xmlUrl = item.source['url'] = _.resolve(_.get(this.xmlbase[0], '#'), item.source['url']);\n            }\n          }\n\n          break;\n\n        case 'enclosure':\n          if (Array.isArray(el)) {\n            el.forEach(function (enc) {\n              enclosure = {};\n              enclosure.url = _.get(enc['@'], 'url');\n              enclosure.type = _.get(enc['@'], 'type');\n              enclosure.length = _.get(enc['@'], 'length');\n\n              if (~indexOfObject(item.enclosures, enclosure, ['url', 'type'])) {\n                item.enclosures.splice(indexOfObject(item.enclosures, enclosure, ['url', 'type']), 1, enclosure);\n              } else {\n                item.enclosures.push(enclosure);\n              }\n            });\n          } else {\n            enclosure = {};\n            enclosure.url = _.get(el['@'], 'url');\n            enclosure.type = _.get(el['@'], 'type');\n            enclosure.length = _.get(el['@'], 'length');\n\n            if (~indexOfObject(item.enclosures, enclosure, ['url', 'type'])) {\n              item.enclosures.splice(indexOfObject(item.enclosures, enclosure, ['url', 'type']), 1, enclosure);\n            } else {\n              item.enclosures.push(enclosure);\n            }\n          }\n\n          break;\n\n        case 'media:content':\n          var optionalAttributes = ['bitrate', 'framerate', 'samplingrate', 'duration', 'height', 'width'];\n\n          if (Array.isArray(el)) {\n            el.forEach(function (enc) {\n              enclosure = {};\n              enclosure.url = _.get(enc['@'], 'url');\n              enclosure.type = _.get(enc['@'], 'type') || _.get(enc['@'], 'medium');\n              enclosure.length = _.get(enc['@'], 'filesize');\n              var index = indexOfObject(item.enclosures, enclosure, ['url', 'type']);\n\n              if (index !== -1) {\n                enclosure = item.enclosures[index];\n              }\n\n              optionalAttributes.forEach(function (attribute) {\n                if (!enclosure[attribute] && _.get(enc['@'], attribute)) {\n                  enclosure[attribute] = _.get(enc['@'], attribute);\n                }\n              });\n\n              if (index === -1) {\n                item.enclosures.push(enclosure);\n              }\n            });\n          } else {\n            enclosure = {};\n            enclosure.url = _.get(el['@'], 'url');\n            enclosure.type = _.get(el['@'], 'type') || _.get(el['@'], 'medium');\n            enclosure.length = _.get(el['@'], 'filesize');\n            var index = indexOfObject(item.enclosures, enclosure, ['url', 'type']);\n\n            if (index !== -1) {\n              enclosure = item.enclosures[index];\n            }\n\n            optionalAttributes.forEach(function (attribute) {\n              if (!enclosure[attribute] && _.get(el['@'], attribute)) {\n                enclosure[attribute] = _.get(el['@'], attribute);\n              }\n            });\n\n            if (index === -1) {\n              item.enclosures.push(enclosure);\n            }\n          }\n\n          break;\n\n        case 'enc:enclosure':\n          // Can't find this in use for an example to debug. Only example found does not comply with the spec -- can't code THAT!\n          break;\n\n        case 'category':\n        case 'dc:subject':\n        case 'itunes:category':\n        case 'media:category':\n          /* We handle all the kinds of categories within the switch loop because item.categories\n           * is an array, unlike the other properties, and therefore can handle multiple values\n           */\n          var _category = '',\n              _categories = [];\n\n          if (Array.isArray(el)) {\n            el.forEach(function (category) {\n              if ('category' == name && 'atom' == type) {\n                if (category['@'] && _.get(category['@'], 'term')) item.categories.push(_.get(category['@'], 'term'));\n              } else if ('category' == name && _.get(category) && 'rss' == type) {\n                item.categories.push(_.get(category).trim());\n              } else if ('dc:subject' == name && _.get(category)) {\n                _categories = _.get(category).split(' ').map(function (cat) {\n                  return cat.trim();\n                });\n                if (_categories.length) item.categories = item.categories.concat(_categories);\n              } else if ('itunes:category' == name) {\n                if (category['@'] && _.get(category['@'], 'text')) _category = _.get(category['@'], 'text');\n\n                if (category[name]) {\n                  if (Array.isArray(category[name])) {\n                    category[name].forEach(function (subcategory) {\n                      if (subcategory['@'] && _.get(subcategory['@'], 'text')) item.categories.push(_category + '/' + _.get(subcategory['@'], 'text'));\n                    });\n                  } else {\n                    if (category[name]['@'] && _.get(category[name]['@'], 'text')) item.categories.push(_category + '/' + _.get(category[name]['@'], 'text'));\n                  }\n                } else {\n                  item.categories.push(_category);\n                }\n              } else if ('media:category' == name) {\n                item.categories.push(_.get(category));\n              }\n            });\n          } else {\n            if ('category' == name && 'atom' == type) {\n              if (_.get(el['@'], 'term')) item.categories.push(_.get(el['@'], 'term'));\n            } else if ('category' == name && _.get(el) && 'rss' == type) {\n              item.categories.push(_.get(el).trim());\n            } else if ('dc:subject' == name && _.get(el)) {\n              _categories = _.get(el).split(' ').map(function (cat) {\n                return cat.trim();\n              });\n              if (_categories.length) item.categories = item.categories.concat(_categories);\n            } else if ('itunes:category' == name) {\n              if (el['@'] && _.get(el['@'], 'text')) _category = _.get(el['@'], 'text');\n\n              if (el[name]) {\n                if (Array.isArray(el[name])) {\n                  el[name].forEach(function (subcategory) {\n                    if (subcategory['@'] && _.get(subcategory['@'], 'text')) item.categories.push(_category + '/' + _.get(subcategory['@'], 'text'));\n                  });\n                } else {\n                  if (el[name]['@'] && _.get(el[name]['@'], 'text')) item.categories.push(_category + '/' + _.get(el[name]['@'], 'text'));\n                }\n              } else {\n                item.categories.push(_category);\n              }\n            } else if ('media:category' == name) {\n              item.categories.push(_.get(el));\n            }\n          }\n\n          break;\n\n        case 'feedburner:origlink':\n        case 'pheedo:origlink':\n          if (!item.origlink) {\n            item.origlink = _.get(el);\n          }\n\n          break;\n      } // switch end\n\n    } // Fill with all native other namespaced properties\n\n\n    if (name.indexOf('#') !== 0) {\n      if (~name.indexOf(':')) item[name] = el;else item[type + ':' + name] = el;\n    }\n  }, this); // forEach end\n\n  if (normalize) {\n    if (!item.description) {\n      if (node['itunes:summary']) item.description = _.get(node['itunes:summary']);\n    }\n\n    if (!item.author) {\n      if (node['itunes:author']) item.author = _.get(node['itunes:author']);else if (node['itunes:owner'] && node['itunes:owner']['itunes:name']) item.author = _.get(node['itunes:owner']['itunes:name']);else if (node['dc:publisher']) item.author = _.get(node['dc:publisher']);\n    }\n\n    if (!item.image.url) {\n      if (node['itunes:image']) item.image.url = _.get(node['itunes:image']['@'], 'href');else if (node['media:thumbnail']) {\n        if (Array.isArray(node['media:thumbnail'])) {\n          item.image.url = _.get(node['media:thumbnail'][0]['@'], 'url');\n        } else {\n          item.image.url = _.get(node['media:thumbnail']['@'], 'url');\n        }\n      } else if (node['media:content'] && node['media:content']['media:thumbnail']) item.image.url = _.get(node['media:content']['media:thumbnail']['@'], 'url');else if (node['media:group'] && node['media:group']['media:thumbnail']) item.image.url = _.get(node['media:group']['media:thumbnail']['@'], 'url');else if (node['media:group'] && node['media:group']['media:content'] && node['media:group']['media:content']['media:thumbnail']) item.image.url = _.get(node['media:group']['media:content']['media:thumbnail']['@'], 'url');else if (node['g:image_link']) item.image.url = _.get(node['g:image_link']);\n    }\n\n    if (item.categories.length) {\n      item.categories = _.uniq(item.categories);\n    }\n\n    if (!item.link) {\n      if (item.guid && /^https?:/.test(item.guid)) {\n        item.link = item.guid;\n      }\n    }\n\n    item.title = item.title && _.stripHtml(item.title);\n  }\n\n  return item;\n}; // Naive Stream API\n\n\nFeedParser.prototype._transform = function (data, encoding, done) {\n  try {\n    this.stream.write(data);\n    done();\n  } catch (e) {\n    done(e);\n    this.push(null); // Manually trigger and end, since we can't reliably do any more parsing\n  }\n};\n\nFeedParser.prototype._flush = function (done) {\n  try {\n    this.stream.end();\n    done();\n  } catch (e) {\n    done(e);\n  }\n};\n\nexports = module.exports = FeedParser;","map":{"version":3,"sources":["/home/jlavan1/classProject/BusinessDashboard-/businessdashboard/node_modules/feedparser/lib/feedparser/index.js"],"names":["sax","require","addressparser","indexOfObject","util","TransformStream","Transform","_","FeedParser","options","call","_readableState","objectMode","highWaterMark","init","assign","strict","normalize","addmeta","resume_saxerror","MAX_BUFFER_LENGTH","feedurl","xmlbase","unshift","stream","createStream","lowercase","xmlns","on","handleSaxError","bind","handleProcessingInstruction","handleOpenTag","handleCloseTag","handleText","handleEnd","inherits","prototype","meta","_namespaces","_emitted_meta","stack","in_xhtml","xhtml","errors","e","Error","handleError","push","emit","resumeSaxError","_parser","error","resume","node","name","body","trim","split","reduce","map","attr","indexOf","parts","length","match","n","prefix","local","uri","Object","keys","attributes","handleAttributes","forEach","nslookup","o","el","stdEl","item","baseurl","isIllegallyNested","shift","slice","join","nsprefix","mayHaveResolvableUrl","resolve","key","title","handleMeta","reresolve","handleItem","author","hasOwnProperty","Array","text","attrs","basepath","simplifiedAttributes","ns","value","type","property","cloud","image","categories","get","description","date","Date","pubdate","pubDate","isArray","link","xmlurl","xmlUrl","isAbsoluteUrl","href","domain","email","address","has","language","url","favicon","copyright","generator","version","_category","_categories","category","_categoryValue","safeTrim","cat","concat","subcategory","_subcategoryValue","uniq","test","stripHtml","source","enclosures","enclosure","summary","origlink","comments","guid","ispermalink","permalink","enc","splice","optionalAttributes","index","attribute","_transform","data","encoding","done","write","_flush","end","exports","module"],"mappings":"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","sourcesContent":["/**********************************************************************\n node-feedparser - A robust RSS, Atom, RDF parser for node.\n http://github.com/danmactough/node-feedparser\n Copyright (c) 2011-2016 Dan MacTough and contributors\n http://mact.me\n\n**********************************************************************/\n\n/**\n * Module dependencies.\n */\nvar sax = require('sax')\n  , addressparser = require('addressparser')\n  , indexOfObject = require('array-indexofobject')\n  , util = require('util')\n  , TransformStream = require('readable-stream').Transform\n  , _ = require('../utils');\n\n/**\n * FeedParser constructor.\n *\n * Exposes a duplex (transform) stream to parse a feed.\n *\n * Each article/post in the feed will have the following keys:\n *   - title {String}\n *   - description {String}\n *   - summary {String}\n *   - date {Date} (or null)\n *   - pubdate {Date} (or null)\n *   - link {String}\n *   - origlink {String}\n *   - author {String}\n *   - guid {String}\n *   - comments {String}\n *   - image {Object}\n *   - categories {Array}\n *   - source {Object}\n *   - enclosures {Array}\n *   - meta {Object}\n *   - Object.keys(meta):\n *     - #ns {Array} key,value pairs of each namespace declared for the feed\n *     - #type {String} one of 'atom', 'rss', 'rdf'\n *     - #version {String}\n *     - title {String}\n *     - description {String}\n *     - date {Date} (or null)\n *     - pubdate {Date} (or null)\n *     - link {String} i.e., to the website, not the feed\n *     - xmlurl {String} the canonical URL of the feed, as declared by the feed\n *     - author {String}\n *     - language {String}\n *     - image {Object}\n *     - favicon {String}\n *     - copyright {String}\n *     - generator {String}\n *     - categories {Array}\n *\n * @param {Object} options\n * @api public\n */\nfunction FeedParser (options) {\n  if (!(this instanceof FeedParser)) return new FeedParser(options);\n  TransformStream.call(this);\n  this._readableState.objectMode = true;\n  this._readableState.highWaterMark = 16; // max. # of output nodes buffered\n\n  this.init();\n\n  // Parse options\n  this.options = _.assign({}, options);\n  if (!('strict' in this.options)) this.options.strict = false;\n  if (!('normalize' in this.options)) this.options.normalize = true;\n  if (!('addmeta' in this.options)) this.options.addmeta = true;\n  if (!('resume_saxerror' in this.options)) this.options.resume_saxerror = true;\n  if ('MAX_BUFFER_LENGTH' in this.options) {\n    sax.MAX_BUFFER_LENGTH = this.options.MAX_BUFFER_LENGTH; // set to Infinity to have unlimited buffers\n  } else {\n    sax.MAX_BUFFER_LENGTH = 16 * 1024 * 1024; // 16M versus the 64K default\n  }\n  if (this.options.feedurl) this.xmlbase.unshift({ '#name': 'xml', '#': this.options.feedurl});\n\n  // See https://github.com/isaacs/sax-js for more info\n  this.stream = sax.createStream(this.options.strict /* strict mode - no by default */, {lowercase: true, xmlns: true });\n  this.stream.on('error', this.handleSaxError.bind(this));\n  this.stream.on('processinginstruction', this.handleProcessingInstruction.bind(this));\n  this.stream.on('opentag', this.handleOpenTag.bind(this));\n  this.stream.on('closetag',this.handleCloseTag.bind(this));\n  this.stream.on('text', this.handleText.bind(this));\n  this.stream.on('cdata', this.handleText.bind(this));\n  this.stream.on('end', this.handleEnd.bind(this));\n}\nutil.inherits(FeedParser, TransformStream);\n\n/*\n * Initializes the SAX stream\n *\n * Initializes the class-variables\n */\nFeedParser.prototype.init = function (){\n  this.meta = {\n    '#ns': [],\n    '@': [],\n    '#xml': {}\n  };\n  this._namespaces = {};\n  this._emitted_meta = false;\n  this.stack = [];\n  this.xmlbase = [];\n  this.in_xhtml = false;\n  this.xhtml = {}; /* Where to store xhtml elements as associative\n                      array with keys: '#' (containing the text)\n                      and '#name' (containing the XML element name) */\n  this.errors = [];\n};\n\nFeedParser.prototype.handleEnd = function (){\n  // We made it to the end without throwing, but let's make sure we were actually\n  // parsing a feed\n  if (!(this.meta && this.meta['#type'])) {\n    var e = new Error('Not a feed');\n    return this.handleError(e);\n  }\n  this.push(null);\n};\n\nFeedParser.prototype.handleSaxError = function (e) {\n  this.emit('error', e);\n  if (this.options.resume_saxerror) {\n    this.resumeSaxError();\n  }\n};\n\nFeedParser.prototype.resumeSaxError = function () {\n  if (this.stream._parser) {\n    this.stream._parser.error = null;\n    this.stream._parser.resume();\n  }\n};\n\nFeedParser.prototype.handleError = function (e){\n  this.emit('error', e);\n};\n\n// parses the xml declaration, which looks like:\n// <?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\nFeedParser.prototype.handleProcessingInstruction = function (node) {\n  if (node.name === 'xml') {\n    this.meta['#xml'] = node.body.trim().split(/\\s+/).reduce(function (map, attr) {\n      if (attr.indexOf('=') >= 0) {\n        var parts = attr.split('=');\n        map[parts[0]] = parts[1] && parts[1].length > 2 && parts[1].match(/^.(.*?).$/)[1];\n      }\n      return map;\n    }, this.meta['#xml']);\n  }\n};\n\nFeedParser.prototype.handleOpenTag = function (node){\n  var n = {};\n  n['#name'] = node.name; // Avoid namespace collissions later...\n  n['#prefix'] = node.prefix; // The current ns prefix\n  n['#local'] = node.local; // The current element name, sans prefix\n  n['#uri'] = node.uri; // The current ns uri\n  n['@'] = {};\n  n['#'] = '';\n\n  if (Object.keys(node.attributes).length) {\n    n['@'] = this.handleAttributes(node.attributes, n['#name']);\n  }\n\n  if (this.in_xhtml && this.xhtml['#name'] != n['#name']) { // We are in an xhtml node\n    // This builds the opening tag, e.g., <div id='foo' class='bar'>\n    this.xhtml['#'] += '<'+n['#name'];\n    Object.keys(n['@']).forEach(function(name){\n      this.xhtml['#'] += ' '+ name +'=\"'+ n['@'][name] + '\"';\n    }, this);\n    this.xhtml['#'] += '>';\n  } else if ( this.stack.length === 0 &&\n              (n['#name'] === 'rss' ||\n              (n['#local'] === 'rdf' && _.nslookup([n['#uri']], 'rdf')) ||\n              (n['#local'] === 'feed'&& _.nslookup([n['#uri']], 'atom')) ) ) {\n    Object.keys(n['@']).forEach(function(name) {\n      var o = {};\n      if (name != 'version') {\n        o[name] = n['@'][name];\n        this.meta['@'].push(o);\n      }\n    }, this);\n    switch(n['#local']) {\n    case 'rss':\n      this.meta['#type'] = 'rss';\n      this.meta['#version'] = n['@']['version'];\n      break;\n    case 'rdf':\n      this.meta['#type'] = 'rdf';\n      this.meta['#version'] = n['@']['version'] || '1.0';\n      break;\n    case 'feed':\n      this.meta['#type'] = 'atom';\n      this.meta['#version'] = n['@']['version'] || '1.0';\n      break;\n    }\n  }\n  this.stack.unshift(n);\n};\n\nFeedParser.prototype.handleCloseTag = function (el){\n  var node = {\n      '#name': el,\n      '#prefix': '',\n      '#local' : ''\n    }\n    , stdEl\n    , item\n    , baseurl\n    , isIllegallyNested = false\n    ;\n  var n = this.stack.shift();\n  el = el.split(':');\n\n  if (el.length > 1 && el[0] === n['#prefix']) {\n    if (_.nslookup(n['#uri'], 'atom')) {\n      node['#prefix'] = el[0];\n      node['#local'] = el.slice(1).join(':');\n      node['#type'] = 'atom';\n    } else if (_.nslookup(n['#uri'], 'rdf')) {\n      node['#prefix'] = el[0];\n      node['#local'] = el.slice(1).join(':');\n      node['#type'] = 'rdf';\n    } else {\n      node['#prefix'] = _.nsprefix(n['#uri']) || n['#prefix'];\n      node['#local'] = el.slice(1).join(':');\n    }\n  } else {\n    node['#local'] = node['#name'];\n    node['#type'] = _.nsprefix(n['#uri']) || n['#prefix'];\n  }\n  delete n['#name'];\n  delete n['#local'];\n  delete n['#prefix'];\n  delete n['#uri'];\n\n  if (this.xmlbase && this.xmlbase.length) {\n    baseurl = this.xmlbase[0]['#'];\n  }\n\n  var mayHaveResolvableUrl = (\n    (\n      (node['#local'] === 'logo' || node['#local'] === 'icon') && node['#type'] === 'atom'\n    ) ||\n    (\n      node['#local'] === 'link' // include rss:link, even though it should _never_ be a relative URL\n    )\n  );\n  if (baseurl && mayHaveResolvableUrl) {\n    // Apply xml:base to these elements as they appear\n    // rather than leaving it to the ultimate parser\n    n['#'] = _.resolve(baseurl, n['#']);\n  }\n\n  if (this.xmlbase.length && (el == this.xmlbase[0]['#name'])) {\n    void this.xmlbase.shift();\n  }\n\n  if (this.in_xhtml) {\n    if (node['#name'] == this.xhtml['#name']) { // The end of the XHTML\n\n      // Add xhtml data to the container element\n      n['#'] += this.xhtml['#'].trim();\n      // Clear xhtml nodes from the tree\n      for (var key in n) {\n        if (key != '@' && key != '#') {\n          delete n[key];\n        }\n      }\n      this.xhtml = {};\n      this.in_xhtml = false;\n    } else { // Somewhere in the middle of the XHTML\n      this.xhtml['#'] += '</' + node['#name'] + '>';\n    }\n  }\n\n  if ('#' in n) {\n    if (n['#'].match(/^\\s*$/)) {\n      // Delete text nodes with nothing by whitespace\n      delete n['#'];\n    } else {\n      n['#'] = n['#'].trim();\n      if (Object.keys(n).length === 1) {\n        // If there is only one text node, hoist it\n        n = n['#'];\n      }\n    }\n  }\n\n  if (node['#name'] === 'item' ||\n      node['#name'] === 'entry' ||\n      (node['#local'] === 'item' && (node['#prefix'] === '' || node['#type'] === 'rdf')) ||\n      (node['#local'] == 'entry' && (node['#prefix'] === '' || node['#type'] === 'atom'))) { // We have an article!\n\n    isIllegallyNested = (\n      ( node['#name'] === 'item' && this.stack[0]['#name'] === 'item' ) ||\n      ( node['#name'] === 'entry' && this.stack[0]['#name'] === 'entry' ) ||\n      ( (node['#local'] === 'item' && (node['#prefix'] === '' || node['#type'] === 'rdf')) && this.stack[0]['#name'] === 'item' ) ||\n      ( (node['#local'] == 'entry' && (node['#prefix'] === '' || node['#type'] === 'atom')) && this.stack[0]['#name'] === 'entry' )\n    );\n\n    if (isIllegallyNested) {\n      return;\n    }\n\n    if (!this.meta.title) { // We haven't yet parsed all the metadata\n      _.assign(this.meta, this.handleMeta(this.stack[0], this.meta['#type'], this.options));\n      if (!this._emitted_meta) {\n        this.emit('meta', this.meta);\n        this._emitted_meta = true;\n      }\n    }\n    if (!baseurl && this.xmlbase && this.xmlbase.length) { // handleMeta was able to infer a baseurl without xml:base or options.feedurl\n      n = _.reresolve(n, this.xmlbase[0]['#']);\n    }\n    item = this.handleItem(n, this.meta['#type'], this.options);\n    if (this.options.addmeta) {\n      item.meta = this.meta;\n    }\n    if (this.meta.author && !item.author) item.author = this.meta.author;\n    this.push(item);\n  } else if (!this.meta.title && // We haven't yet parsed all the metadata\n              (node['#name'] === 'channel' ||\n               node['#name'] === 'feed' ||\n               (node['#local'] === 'channel' && (node['#prefix'] === '' || node['#type'] === 'rdf')) ||\n               (node['#local'] === 'feed' && (node['#prefix'] === '' || node['#type'] === 'atom')) ) ) {\n    _.assign(this.meta, this.handleMeta(n, this.meta['#type'], this.options));\n    if (!this._emitted_meta) {\n      this.emit('meta', this.meta);\n      this._emitted_meta = true;\n    }\n  }\n\n  if (this.stack.length > 0) {\n    if (node['#prefix'] && node['#local'] && !node['#type']) {\n      stdEl = node['#prefix'] + ':' + node['#local'];\n    } else if (node['#name'] && node['#type'] && node['#type'] !== this.meta['#type']) {\n      stdEl = node['#name'];\n    } else {\n      stdEl = node['#local'] || node['#name'];\n    }\n    if (!this.stack[0].hasOwnProperty(stdEl)) {\n      this.stack[0][stdEl] = n;\n    } else if (this.stack[0][stdEl] instanceof Array) {\n      this.stack[0][stdEl].push(n);\n    } else {\n      this.stack[0][stdEl] = [this.stack[0][stdEl], n];\n    }\n  }\n};\n\nFeedParser.prototype.handleText = function (text){\n  if (this.in_xhtml) {\n    this.xhtml['#'] += text;\n  } else {\n    if (this.stack.length) {\n      if (this.stack[0] && '#' in this.stack[0]) {\n        this.stack[0]['#'] += text;\n      } else {\n        this.stack[0]['#'] = text;\n      }\n    }\n  }\n};\n\nFeedParser.prototype.handleAttributes = function handleAttributes (attrs, el) {\n  /*\n   * Using the sax.js option { xmlns: true }\n   * attrs is an array of objects (not strings) having the following properties\n   * name - e.g., xmlns:dc or href\n   * value\n   * prefix - the first part of the name of the attribute (before the colon)\n   * local - the second part of the name of the attribute (after the colon)\n   * uri - the uri of the namespace\n   *\n   */\n\n  var basepath = ''\n    , simplifiedAttributes = {}\n    ;\n\n  if (this.xmlbase && this.xmlbase.length) {\n    basepath = this.xmlbase[0]['#'];\n  }\n\n  Object.keys(attrs).forEach(function(key){\n    var attr = attrs[key]\n      , ns = {}\n      , prefix = ''\n      ;\n    if (attr.prefix === 'xmlns') {\n      if (!(attr.name in this._namespaces)) {\n        ns[attr.name] = attr.value;\n        this.meta['#ns'].push(ns);\n        _.assign(this._namespaces, ns);\n      }\n    }\n    // If the feed is using a non-default prefix, we'll use it, too\n    // But we force the use of the 'xml' prefix\n    if (attr.uri && attr.prefix && !_.nslookup(attr.uri, attr.prefix) || _.nslookup(attr.uri, 'xml')) {\n      prefix = ( _.nsprefix(attr.uri) || attr.prefix ) + ( attr.local ? ':' : '' );\n    }\n    if (basepath && (attr.local == 'href' || attr.local == 'src' || attr.local == 'uri')) {\n      // Apply xml:base to these elements as they appear\n      // rather than leaving it to the ultimate parser\n      attr.value = _.resolve(basepath, attr.value);\n    } else if (attr.local === 'base' && _.nslookup(attr.uri, 'xml')) {\n      // Keep track of the xml:base for the current node\n      if (basepath) {\n        attr.value = _.resolve(basepath, attr.value);\n      }\n      this.xmlbase.unshift({ '#name': el, '#': attr.value});\n    } else if (attr.name === 'type' && attr.value === 'xhtml') {\n      this.in_xhtml = true;\n      this.xhtml = {'#name': el, '#': ''};\n    }\n    simplifiedAttributes[prefix + attr.local] = attr.value ? attr.value.trim() : '';\n  }, this);\n  return simplifiedAttributes;\n};\n\nFeedParser.prototype.handleMeta = function handleMeta (node, type, options) {\n  if (!type || !node) return {};\n\n  var meta = {}\n    , normalize = !options || (options && options.normalize)\n    ;\n\n  if (normalize) {\n    ['title','description','date', 'pubdate', 'pubDate','link', 'xmlurl', 'xmlUrl','author','language','favicon','copyright','generator'].forEach(function (property){\n      meta[property] = null;\n    });\n    meta.cloud = {};\n    meta.image = {};\n    meta.categories = [];\n  }\n\n  Object.keys(node).forEach(function(name){\n    var el = node[name];\n\n    if (normalize) {\n      switch(name){\n      case('title'):\n        meta.title = _.get(el);\n        break;\n      case('description'):\n      case('subtitle'):\n        meta.description = _.get(el);\n        break;\n      case('pubdate'):\n      case('lastbuilddate'):\n      case('published'):\n      case('modified'):\n      case('updated'):\n      case('dc:date'):\n        var date = _.get(el) ? new Date(_.get(el)) : null;\n        if (!date) break;\n        if (meta.pubdate === null || name == 'pubdate' || name == 'published')\n          meta.pubdate = meta.pubDate = date;\n        if (meta.date === null || name == 'lastbuilddate' || name == 'modified' || name == 'updated')\n          meta.date = date;\n        break;\n      case('link'):\n      case('atom:link'):\n      case('atom10:link'):\n        if (Array.isArray(el)) {\n          el.forEach(function (link){\n            if (link['@']['href']) { // Atom\n              if (_.get(link['@'], 'rel')) {\n                if (link['@']['rel'] == 'alternate') {\n                  if (!meta.link) meta.link = link['@']['href'];\n                }\n                else if (link['@']['rel'] == 'self') {\n                  meta.xmlurl = meta.xmlUrl = link['@']['href'];\n                  if (_.isAbsoluteUrl(meta.xmlurl) && this.xmlbase && this.xmlbase.length === 0) {\n                    this.xmlbase.unshift({ '#name': 'xml', '#': meta.xmlurl });\n                    this.stack[0] = _.reresolve(this.stack[0], meta.xmlurl);\n                  }\n                  else if (this.xmlbase && this.xmlbase.length > 0) {\n                    meta.xmlurl = meta.xmlUrl = _.resolve(_.get(this.xmlbase[0], '#'), meta.xmlurl);\n                  }\n                }\n                else if (link['@']['rel'] == 'hub' && !(meta.cloud.href || meta.cloud.domain)) {\n                  meta.cloud.type = 'hub';\n                  meta.cloud.href = link['@']['href'];\n                }\n              } else {\n                if (!meta.link) meta.link = link['@']['href'];\n              }\n            } else if (Object.keys(link['@']).length === 0) { // RSS\n              meta.link = _.get(link);\n            }\n            if (_.isAbsoluteUrl(meta.link) && this.xmlbase && this.xmlbase.length === 0) {\n              this.xmlbase.unshift({ '#name': 'xml', '#': meta.link});\n              this.stack[0] = _.reresolve(this.stack[0], meta.link);\n            }\n            else if (this.xmlbase && this.xmlbase.length > 0) {\n              meta.link = _.resolve(_.get(this.xmlbase[0], '#'), meta.link);\n            }\n          }, this);\n        } else {\n          if (el['@']['href']) { // Atom\n            if (_.get(el['@'], 'rel')) {\n              if (el['@']['rel'] == 'alternate') {\n                if (!meta.link) meta.link = el['@']['href'];\n              }\n              else if (el['@']['rel'] == 'self') {\n                meta.xmlurl = meta.xmlUrl = el['@']['href'];\n                if (_.isAbsoluteUrl(meta.xmlurl) && this.xmlbase && this.xmlbase.length === 0) {\n                  this.xmlbase.unshift({ '#name': 'xml', '#': meta.xmlurl});\n                  this.stack[0] = _.reresolve(this.stack[0], meta.xmlurl);\n                }\n                else if (this.xmlbase && this.xmlbase.length > 0) {\n                  meta.xmlurl = meta.xmlUrl = _.resolve(_.get(this.xmlbase[0], '#'), meta.xmlurl);\n                }\n              }\n              else if (el['@']['rel'] == 'hub' && !(meta.cloud.href || meta.cloud.domain)) {\n                meta.cloud.type = 'hub';\n                meta.cloud.href = el['@']['href'];\n              }\n            } else {\n              meta.link = el['@']['href'];\n            }\n          } else if (Object.keys(el['@']).length === 0) { // RSS\n            if (!meta.link) meta.link = _.get(el);\n          }\n          if (_.isAbsoluteUrl(meta.link) && this.xmlbase && this.xmlbase.length === 0) {\n            this.xmlbase.unshift({ '#name': 'xml', '#': meta.link});\n            this.stack[0] = _.reresolve(this.stack[0], meta.link);\n          }\n          else if (this.xmlbase && this.xmlbase.length > 0) {\n            meta.link = _.resolve(_.get(this.xmlbase[0], '#'), meta.link);\n          }\n        }\n        break;\n      case('managingeditor'):\n      case('webmaster'):\n      case('author'):\n        var author = {};\n        if (name == 'author') {\n          meta.author = _.get(el.name) || _.get(el.email) || _.get(el.uri);\n        }\n        else if (_.get(el)) {\n          author = addressparser(_.get(el))[0];\n          if (author) {\n            el['name'] = author.name;\n            el['email'] = author.address;\n          }\n          if (meta.author === null || name == 'managingeditor') {\n            meta.author = author.name || author.address || _.get(el);\n          }\n        }\n        break;\n      case('cloud'):\n        // I can't believe someone actually would put two cloud elements in their channel\n        // but it happened\n        // Nevertheless, there can be only one\n        // This will ensure that rssCloud \"wins\" here.\n        // If pubsubhubbub is also declared, it's still available in the link elements\n        meta.cloud = {};\n        if (Array.isArray(el)) {\n          Object.keys(el[0]['@']).forEach(function (attr) {\n            if (_.has(el[0]['@'], attr)) {\n              meta.cloud[attr] = el[0]['@'][attr];\n            }\n          });\n        }\n        else {\n          Object.keys(el['@']).forEach(function (attr) {\n            if (_.has(el['@'], attr)) {\n              meta.cloud[attr] = el['@'][attr];\n            }\n          });\n        }\n        meta.cloud.type = 'rsscloud';\n        break;\n      case('language'):\n        meta.language = _.get(el);\n        break;\n      case('image'):\n      case('logo'):\n        if (el.url)\n          meta.image.url = _.get(el.url);\n        if (el.title)\n          meta.image.title = _.get(el.title);\n        if (!meta.image.url && _.get(el))\n          meta.image.url = _.get(el);\n        break;\n      case('icon'):\n        meta.favicon = _.get(el);\n        break;\n      case('copyright'):\n      case('rights'):\n      case('dc:rights'):\n        meta.copyright = _.get(el);\n        break;\n      case('generator'):\n        meta.generator = _.get(el);\n        if (_.get(el['@'], 'version'))\n          meta.generator += (meta.generator ? ' ' : '') + 'v' + el['@'].version;\n        if (_.get(el['@'], 'uri'))\n          meta.generator += meta.generator ? ' (' + el['@'].uri + ')' : el['@'].uri;\n        break;\n      case('category'):\n      case('dc:subject'):\n      case('itunes:category'):\n      case('media:category'):\n        /* We handle all the kinds of categories within the switch loop because meta.categories\n         * is an array, unlike the other properties, and therefore can handle multiple values\n         */\n        var _category = ''\n          , _categories = []\n          ;\n        if (Array.isArray(el)) {\n          el.forEach(function (category){\n            var _categoryValue;\n            if ('category' == name && 'atom' == type) {\n              if (category['@'] && (_categoryValue = _.safeTrim(_.get(category['@'], 'term')))) {\n                meta.categories.push(_categoryValue);\n              }\n            }\n            else if ('category' == name && 'rss' == type){\n              if ((_categoryValue = _.safeTrim(_.get(category)))) {\n                meta.categories.push(_categoryValue);\n              }\n            }\n            else if ('dc:subject' == name && (_categoryValue = _.safeTrim(_.get(category)))) {\n              _categories = _categoryValue.split(' ').map(function (cat){ return cat.trim(); });\n              if (_categories.length) {\n                meta.categories = meta.categories.concat(_categories);\n              }\n            }\n            else if ('itunes:category' == name) {\n              if (category['@'] && _.safeTrim(_.get(category['@'], 'text'))) _category = _.safeTrim(_.get(category['@'], 'text'));\n              if (category[name]) {\n                if (Array.isArray(category[name])) {\n                  category[name].forEach(function (subcategory){\n                    var _subcategoryValue;\n                    if (subcategory['@'] && (_subcategoryValue = _.safeTrim(_.get(subcategory['@'], 'text')))) {\n                      meta.categories.push(_category + '/' + _subcategoryValue);\n                    }\n                  });\n                }\n                else if (category[name]['@'] && (_categoryValue = _.safeTrim(_.get(category[name]['@'], 'text')))) {\n                  meta.categories.push(_category + '/' + _categoryValue);\n                }\n              }\n              else if (_category) {\n                meta.categories.push(_category);\n              }\n            }\n            else if ('media:category' == name && (_categoryValue = _.safeTrim(_.get(category)))) {\n              meta.categories.push(_categoryValue);\n            }\n          });\n        } else {\n          if ('category' == name && 'atom' == type) {\n            if ((_category = _.safeTrim(_.get(el['@'], 'term')))) {\n              meta.categories.push(_category);\n            }\n          }\n          else if ('category' == name && 'rss' == type) {\n            if ((_category = _.safeTrim(_.get(el)))) {\n              meta.categories.push(_category);\n            }\n          }\n          else if ('dc:subject' == name && (_category = _.safeTrim(_.get(el)))) {\n            _categories = _category.split(' ').map(function (cat){ return cat.trim(); });\n            if (_categories.length) {\n              meta.categories = meta.categories.concat(_categories);\n            }\n          }\n          else if ('itunes:category' == name) {\n            if (el['@'] && _.safeTrim(_.get(el['@'], 'text'))) _category = _.safeTrim(_.get(el['@'], 'text'));\n            if (el[name]) {\n              if (Array.isArray(el[name])) {\n                el[name].forEach(function (subcategory){\n                  var _subcategoryValue;\n                  if (subcategory['@'] && (_subcategoryValue = _.safeTrim(_.get(subcategory['@'], 'text')))) {\n                    meta.categories.push(_category + '/' + _subcategoryValue);\n                  }\n                });\n              }\n              else if (el[name]['@'] && (_category = _.safeTrim(_.get(el[name]['@'], 'text')))) {\n                meta.categories.push(_category + '/' + _category);\n              }\n            }\n            else if (_category) {\n              meta.categories.push(_category);\n            }\n          }\n          else if ('media:category' == name && (_category = _.safeTrim(_.get(el)))) {\n            meta.categories.push(_.get(el));\n          }\n        }\n        break;\n      } // switch end\n    }\n    // Fill with all native other namespaced properties\n    if (name.indexOf('#') !== 0) {\n      if (~name.indexOf(':')) meta[name] = el;\n      else meta[type + ':' + name] = el;\n    }\n  }, this); // forEach end\n\n  if (normalize) {\n    if (!meta.description) {\n      if (node['itunes:summary']) meta.description = _.get(node['itunes:summary']);\n      else if (node['tagline']) meta.description = _.get(node['tagline']);\n    }\n    if (!meta.author) {\n      if (node['itunes:author']) meta.author = _.get(node['itunes:author']);\n      else if (node['itunes:owner'] && node['itunes:owner']['itunes:name']) meta.author = _.get(node['itunes:owner']['itunes:name']);\n      else if (node['dc:creator']) meta.author = _.get(node['dc:creator']);\n      else if (node['dc:publisher']) meta.author = _.get(node['dc:publisher']);\n    }\n    if (!meta.language) {\n      if (node['@'] && node['@']['xml:lang']) meta.language = _.get(node['@'], 'xml:lang');\n      else if (node['dc:language']) meta.language = _.get(node['dc:language']);\n    }\n    if (!meta.image.url) {\n      if (node['itunes:image']) meta.image.url = _.get(node['itunes:image']['@'], 'href');\n      else if (node['media:thumbnail']) {\n        if (Array.isArray(node['media:thumbnail'])) {\n          node['media:thumbnail'] = node['media:thumbnail'][0];\n        }\n        meta.image.url = _.get(node['media:thumbnail']['@'], 'url');\n      }\n    }\n    if (!meta.copyright) {\n      if (node['media:copyright']) meta.copyright = _.get(node['media:copyright']);\n      else if (node['dc:rights']) meta.copyright = _.get(node['dc:rights']);\n      else if (node['creativecommons:license']) meta.copyright = _.get(node['creativecommons:license']);\n      else if (node['cc:license']) {\n        if (Array.isArray(node['cc:license']) && node['cc:license'][0]['@'] && node['cc:license'][0]['@']['rdf:resource']) {\n          meta.copyright = _.get(node['cc:license'][0]['@'], 'rdf:resource');\n        } else if (node['cc:license']['@'] && node['cc:license']['@']['rdf:resource']) {\n          meta.copyright = _.get(node['cc:license']['@'], 'rdf:resource');\n        }\n      }\n    }\n    if (!meta.generator) {\n      if (node['admin:generatoragent']) {\n        if (Array.isArray(node['admin:generatoragent']) && node['admin:generatoragent'][0]['@'] && node['admin:generatoragent'][0]['@']['rdf:resource']) {\n          meta.generator = _.get(node['admin:generatoragent'][0]['@'], 'rdf:resource');\n        } else if (node['admin:generatoragent']['@'] && node['admin:generatoragent']['@']['rdf:resource']) {\n          meta.generator = _.get(node['admin:generatoragent']['@'], 'rdf:resource');\n        }\n      }\n    }\n    if (meta.categories.length) {\n      meta.categories = _.uniq(meta.categories);\n    }\n    if (!meta.link) {\n      if (meta['atom:id'] && _.get(meta['atom:id']) && /^https?:/.test(_.get(meta['atom:id']))) {\n        meta.link = _.get(meta['atom:id']);\n      }\n    }\n    if (!meta.xmlurl && this.options.feedurl) {\n      meta.xmlurl = meta.xmlUrl = this.options.feedurl;\n    }\n    meta.title = meta.title && _.stripHtml(meta.title);\n    meta.description = meta.description && _.stripHtml(meta.description);\n  }\n\n  return meta;\n};\n\nFeedParser.prototype.handleItem = function handleItem (node, type, options){\n  if (!type || !node) return {};\n\n  var item = {}\n    , normalize = !options || (options && options.normalize)\n    ;\n\n  if (normalize) {\n    ['title','description','summary','date','pubdate','pubDate','link','guid','author','comments', 'origlink'].forEach(function (property){\n      item[property] = null;\n    });\n    item.image = {};\n    item.source = {};\n    item.categories = [];\n    item.enclosures = [];\n  }\n\n  Object.keys(node).forEach(function(name){\n    var el = node[name]\n      , attrs = _.get(el, '@')\n      , enclosure;\n    if (normalize) {\n      switch(name){\n      case('title'):\n        item.title = _.get(el);\n        break;\n      case('description'):\n      case('summary'):\n        item.summary = _.get(el);\n        if (!item.description) item.description = _.get(el);\n        break;\n      case('content'):\n      case('content:encoded'):\n        item.description = _.get(el);\n        break;\n      case('pubdate'):\n      case('published'):\n      case('issued'):\n      case('modified'):\n      case('updated'):\n      case('dc:date'):\n        var date = _.get(el) ? new Date(_.get(el)) : null;\n        if (!date) break;\n        if (item.pubdate === null || name == 'pubdate' || name == 'published' || name == 'issued')\n          item.pubdate = item.pubDate = date;\n        if (item.date === null || name == 'modified' || name == 'updated')\n          item.date = date;\n        break;\n      case('link'):\n        if (Array.isArray(el)) {\n          el.forEach(function (link){\n            if (link['@']['href']) { // Atom\n              if (_.get(link['@'], 'rel')) {\n                if (link['@']['rel'] == 'canonical') item.origlink = link['@']['href'];\n                if (link['@']['rel'] == 'alternate') item.link = link['@']['href'];\n                if (link['@']['rel'] == 'self' && !item.link) item.link = link['@']['href'];\n                if (link['@']['rel'] == 'replies') item.comments = link['@']['href'];\n                if (link['@']['rel'] == 'enclosure') {\n                  enclosure = {};\n                  enclosure.url = link['@']['href'];\n                  enclosure.type = _.get(link['@'], 'type');\n                  enclosure.length = _.get(link['@'], 'length');\n                  if (indexOfObject(item.enclosures, enclosure, ['url', 'type']) === -1) {\n                    item.enclosures.push(enclosure);\n                  }\n                }\n              } else {\n                item.link = link['@']['href'];\n              }\n            } else if (Object.keys(link['@']).length === 0) { // RSS\n              if (!item.link) item.link = _.get(link);\n            }\n          });\n        } else {\n          if (el['@']['href']) { // Atom\n            if (_.get(el['@'], 'rel')) {\n              if (el['@']['rel'] == 'canonical') item.origlink = el['@']['href'];\n              if (el['@']['rel'] == 'alternate') item.link = el['@']['href'];\n              if (el['@']['rel'] == 'self' && !item.link) item.link = el['@']['href'];\n              if (el['@']['rel'] == 'replies') item.comments = el['@']['href'];\n              if (el['@']['rel'] == 'enclosure') {\n                enclosure = {};\n                enclosure.url = el['@']['href'];\n                enclosure.type = _.get(el['@'], 'type');\n                enclosure.length = _.get(el['@'], 'length');\n                if (indexOfObject(item.enclosures, enclosure, ['url', 'type']) === -1) {\n                  item.enclosures.push(enclosure);\n                }\n              }\n            } else {\n              item.link = el['@']['href'];\n            }\n          } else if (Object.keys(el['@']).length === 0) { // RSS\n            if (!item.link) item.link = _.get(el);\n          }\n        }\n        if (!item.guid) item.guid = item.link;\n        break;\n      case('guid'):\n      case('id'):\n        item.guid = _.get(el);\n        // http://cyber.law.harvard.edu/rss/rss.html#ltguidgtSubelementOfLtitemgt\n        // If the guid element has an attribute named \"isPermaLink\" with a value\n        // of true, the reader may assume that it is a permalink to the item,\n        // that is, a url that can be opened in a Web browser, that points to\n        // the full item described by the <item> element.\n        // isPermaLink is optional, its default value is true. If its value is\n        // false, the guid may not be assumed to be a url, or a url to anything\n        // in particular.\n        if (item.guid && type == 'rss' && name == 'guid' && !(attrs.ispermalink && attrs.ispermalink.match(/false/i))) {\n          item.permalink = item.guid;\n        }\n        break;\n      case('author'):\n        var author = {};\n        if (_.get(el)) { // RSS\n          author = addressparser(_.get(el))[0];\n          if (author) {\n            el['name'] = author.name;\n            el['email'] = author.address;\n            item.author = author.name || author.address;\n          }\n          // addressparser failed\n          else {\n            item.author = _.get(el);\n          }\n        } else {\n          item.author = _.get(el.name) || _.get(el.email) || _.get(el.uri);\n        }\n        break;\n      case('dc:creator'):\n        item.author = _.get(el);\n        break;\n      case('comments'):\n        item.comments = _.get(el);\n        break;\n      case('source'):\n        if ('rss' == type) {\n          item.source['title'] = _.get(el);\n          item.source['url'] = _.get(el['@'], 'url');\n        } else if ('atom' == type) {\n          if (el.title && _.get(el.title))\n            item.source['title'] = _.get(el.title);\n          if (el.link && _.get(el.link['@'], 'href'))\n            item.source['url'] = _.get(el.link['@'], 'href');\n        }\n        if (item.source['url'] && !this.meta.xmlurl) {\n          this.meta.xmlurl = this.meta.xmlUrl = item.source['url'];\n          if (_.isAbsoluteUrl(item.source['url']) && this.xmlbase && this.xmlbase.length === 0) {\n            this.xmlbase.unshift({ '#name': 'xml', '#': item.source['url']});\n            this.stack[0] = _.reresolve(this.stack[0], item.source['url']);\n          }\n          else if (this.xmlbase && this.xmlbase.length > 0) {\n            this.meta.xmlurl = this.meta.xmlUrl = item.source['url'] = _.resolve(_.get(this.xmlbase[0], '#'), item.source['url']);\n          }\n        }\n        break;\n      case('enclosure'):\n        if (Array.isArray(el)) {\n          el.forEach(function (enc){\n            enclosure = {};\n            enclosure.url = _.get(enc['@'], 'url');\n            enclosure.type = _.get(enc['@'], 'type');\n            enclosure.length = _.get(enc['@'], 'length');\n            if (~indexOfObject(item.enclosures, enclosure, ['url', 'type'])) {\n              item.enclosures.splice(indexOfObject(item.enclosures, enclosure, ['url', 'type']), 1, enclosure);\n            } else {\n              item.enclosures.push(enclosure);\n            }\n          });\n        } else {\n          enclosure = {};\n          enclosure.url = _.get(el['@'], 'url');\n          enclosure.type = _.get(el['@'], 'type');\n          enclosure.length = _.get(el['@'], 'length');\n          if (~indexOfObject(item.enclosures, enclosure, ['url', 'type'])) {\n            item.enclosures.splice(indexOfObject(item.enclosures, enclosure, ['url', 'type']), 1, enclosure);\n          } else {\n            item.enclosures.push(enclosure);\n          }\n        }\n        break;\n      case('media:content'):\n        var optionalAttributes = ['bitrate', 'framerate', 'samplingrate', 'duration', 'height', 'width'];\n        if (Array.isArray(el)) {\n          el.forEach(function (enc){\n            enclosure = {};\n            enclosure.url = _.get(enc['@'], 'url');\n            enclosure.type = _.get(enc['@'], 'type') || _.get(enc['@'], 'medium');\n            enclosure.length = _.get(enc['@'], 'filesize');\n            var index = indexOfObject(item.enclosures, enclosure, ['url', 'type']);\n            if (index !== -1) {\n              enclosure = item.enclosures[index];\n            }\n            optionalAttributes.forEach(function (attribute) {\n              if (!enclosure[attribute] && _.get(enc['@'], attribute)) {\n                enclosure[attribute] = _.get(enc['@'], attribute);\n              }\n            });\n            if (index === -1) {\n              item.enclosures.push(enclosure);\n            }\n          });\n        } else {\n          enclosure = {};\n          enclosure.url = _.get(el['@'], 'url');\n          enclosure.type = _.get(el['@'], 'type') || _.get(el['@'], 'medium');\n          enclosure.length = _.get(el['@'], 'filesize');\n          var index = indexOfObject(item.enclosures, enclosure, ['url', 'type']);\n          if (index !== -1) {\n            enclosure = item.enclosures[index];\n          }\n          optionalAttributes.forEach(function (attribute) {\n            if (!enclosure[attribute] && _.get(el['@'], attribute)) {\n              enclosure[attribute] = _.get(el['@'], attribute);\n            }\n          });\n          if (index === -1) {\n            item.enclosures.push(enclosure);\n          }\n        }\n        break;\n      case('enc:enclosure'): // Can't find this in use for an example to debug. Only example found does not comply with the spec -- can't code THAT!\n        break;\n      case('category'):\n      case('dc:subject'):\n      case('itunes:category'):\n      case('media:category'):\n        /* We handle all the kinds of categories within the switch loop because item.categories\n         * is an array, unlike the other properties, and therefore can handle multiple values\n         */\n        var _category = ''\n          , _categories = []\n          ;\n        if (Array.isArray(el)) {\n          el.forEach(function (category){\n            if ('category' == name && 'atom' == type) {\n              if (category['@'] && _.get(category['@'], 'term')) item.categories.push(_.get(category['@'], 'term'));\n            } else if ('category' == name && _.get(category) && 'rss' == type) {\n              item.categories.push(_.get(category).trim());\n            } else if ('dc:subject' == name && _.get(category)) {\n              _categories = _.get(category).split(' ').map(function (cat){ return cat.trim(); });\n              if (_categories.length) item.categories = item.categories.concat(_categories);\n            } else if ('itunes:category' == name) {\n              if (category['@'] && _.get(category['@'], 'text')) _category = _.get(category['@'], 'text');\n              if (category[name]) {\n                if (Array.isArray(category[name])) {\n                  category[name].forEach(function (subcategory){\n                    if (subcategory['@'] && _.get(subcategory['@'], 'text')) item.categories.push(_category + '/' + _.get(subcategory['@'], 'text'));\n                  });\n                } else {\n                  if (category[name]['@'] && _.get(category[name]['@'], 'text'))\n                    item.categories.push(_category + '/' + _.get(category[name]['@'], 'text'));\n                }\n              } else {\n                item.categories.push(_category);\n              }\n            } else if ('media:category' == name) {\n              item.categories.push(_.get(category));\n            }\n          });\n        } else {\n          if ('category' == name && 'atom' == type) {\n            if (_.get(el['@'], 'term')) item.categories.push(_.get(el['@'], 'term'));\n          } else if ('category' == name && _.get(el) && 'rss' == type) {\n            item.categories.push(_.get(el).trim());\n          } else if ('dc:subject' == name && _.get(el)) {\n            _categories = _.get(el).split(' ').map(function (cat){ return cat.trim(); });\n            if (_categories.length) item.categories = item.categories.concat(_categories);\n          } else if ('itunes:category' == name) {\n            if (el['@'] && _.get(el['@'], 'text')) _category = _.get(el['@'], 'text');\n            if (el[name]) {\n              if (Array.isArray(el[name])) {\n                el[name].forEach(function (subcategory){\n                  if (subcategory['@'] && _.get(subcategory['@'], 'text')) item.categories.push(_category + '/' + _.get(subcategory['@'], 'text'));\n                });\n              } else {\n                if (el[name]['@'] && _.get(el[name]['@'], 'text'))\n                  item.categories.push(_category + '/' + _.get(el[name]['@'], 'text'));\n              }\n            } else {\n              item.categories.push(_category);\n            }\n          } else if ('media:category' == name) {\n            item.categories.push(_.get(el));\n          }\n        }\n        break;\n      case('feedburner:origlink'):\n      case('pheedo:origlink'):\n        if (!item.origlink) {\n          item.origlink = _.get(el);\n        }\n        break;\n      } // switch end\n    }\n    // Fill with all native other namespaced properties\n    if (name.indexOf('#') !== 0) {\n      if (~name.indexOf(':')) item[name] = el;\n      else item[type + ':' + name] = el;\n    }\n  }, this); // forEach end\n\n  if (normalize) {\n    if (!item.description) {\n      if (node['itunes:summary']) item.description = _.get(node['itunes:summary']);\n    }\n    if (!item.author) {\n      if (node['itunes:author']) item.author = _.get(node['itunes:author']);\n      else if (node['itunes:owner'] && node['itunes:owner']['itunes:name']) item.author = _.get(node['itunes:owner']['itunes:name']);\n      else if (node['dc:publisher']) item.author = _.get(node['dc:publisher']);\n    }\n    if (!item.image.url) {\n      if (node['itunes:image']) item.image.url = _.get(node['itunes:image']['@'], 'href');\n      else if (node['media:thumbnail']) {\n        if (Array.isArray(node['media:thumbnail'])) {\n          item.image.url = _.get(node['media:thumbnail'][0]['@'], 'url');\n        } else {\n          item.image.url = _.get(node['media:thumbnail']['@'], 'url');\n        }\n      }\n      else if (node['media:content'] && node['media:content']['media:thumbnail']) item.image.url = _.get(node['media:content']['media:thumbnail']['@'], 'url');\n      else if (node['media:group'] && node['media:group']['media:thumbnail']) item.image.url = _.get(node['media:group']['media:thumbnail']['@'], 'url');\n      else if (node['media:group'] && node['media:group']['media:content'] && node['media:group']['media:content']['media:thumbnail']) item.image.url = _.get(node['media:group']['media:content']['media:thumbnail']['@'], 'url');\n      else if (node['g:image_link']) item.image.url = _.get(node['g:image_link']);\n    }\n    if (item.categories.length) {\n      item.categories = _.uniq(item.categories);\n    }\n    if (!item.link) {\n      if (item.guid && /^https?:/.test(item.guid)) {\n        item.link = item.guid;\n      }\n    }\n    item.title = item.title && _.stripHtml(item.title);\n  }\n  return item;\n};\n\n// Naive Stream API\nFeedParser.prototype._transform = function (data, encoding, done) {\n  try {\n    this.stream.write(data);\n    done();\n  }\n  catch (e) {\n    done(e);\n    this.push(null); // Manually trigger and end, since we can't reliably do any more parsing\n  }\n};\n\nFeedParser.prototype._flush = function (done) {\n  try {\n    this.stream.end();\n    done();\n  }\n  catch (e) {\n    done(e);\n  }\n};\n\nexports = module.exports = FeedParser;\n"]},"metadata":{},"sourceType":"script"}